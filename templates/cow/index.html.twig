{% extends 'base.html.twig' %}

{% block title %}
    {{ title }}
{% endblock %}

{% block body %}
<div class="container mt-4">

    <h1 class="mb-4">{{ title }}</h1>

    <a href="{{ path('cow_add') }}" class="btn btn-success mb-3">
        Adicionar Novo Animal
    </a>

    <table class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>C√≥digo</th>
                <th>Fazenda</th>
                <th>Leite/semana</th>
                <th>Ra√ß√£o/semana</th>
                <th>Peso</th>
                <th>Nascimento</th>
                <th>Status</th>
                <th>Abate</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>

        <tbody>
        {% for cow in cows %}

            {% set ageYears = date().diff(cow.birthdate).y %}
            {% set dailyFood = (cow.foodperweek / 7) %}
            {% set canBeSlaughtered =
                ageYears > 5
                or cow.milkperweek < 40
                or (cow.milkperweek < 70 and dailyFood > 50)
                or cow.weight > (18 * 15)
            %}

            <tr>
                <td>{{ cow.id }}</td>
                <td>{{ cow.code }}</td>
                <td>{{ cow.farm.name }}</td>

                <td>{{ cow.milkperweek|number_format(1, ',', '.') }} L</td>
                <td>{{ cow.foodperweek|number_format(1, ',', '.') }} Kg</td>
                <td>{{ cow.weight|number_format(1, ',', '.') }} Kg</td>

                <td>{{ cow.birthdate|date('d/m/Y') }}</td>

                <td>
                    {% if cow.isalive %}
                        <span class="badge bg-success">Vivo</span>
                    {% else %}
                        <span class="badge bg-danger">Morto</span>
                    {% endif %}
                </td>

                <td class="text-center">

                    {% if cow.isslaughtered %}
                        <span class="badge bg-danger">J√° Abatido</span><br>
                        <small class="text-muted">
                            {{ cow.slaughterdate ? cow.slaughterdate|date('d/m/Y') : '' }}
                        </small>

                    {% elseif not cow.isalive %}
                        <span class="badge bg-secondary">Morto (n√£o abatido)</span>

                    {% else %}
                        {% if canBeSlaughtered %}
                            <a href="{{ path('cow_slaughter', {id: cow.id}) }}"
                               class="btn btn-danger btn-sm">
                                ü•© Abater
                            </a>
                        {% else %}
                            <button class="btn btn-secondary btn-sm" disabled>
                                ü•© N√£o eleg√≠vel
                            </button>
                        {% endif %}
                    {% endif %}
                </td>

                <td>
                    <a href="{{ path('cow_edit', {id: cow.id}) }}"
                       class="btn btn-primary btn-sm">
                        ‚úèÔ∏è Editar
                    </a>

                    <a href="{{ path('cow_remove', {id: cow.id}) }}"
                       class="btn btn-danger btn-sm">
                        üóëÔ∏è Excluir
                    </a>
                </td>
            </tr>

        {% else %}
            <tr>
                <td colspan="10" class="text-center text-muted py-3">
                    Nenhum animal cadastrado.
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
